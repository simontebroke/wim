import{jsx as t,jsxs as e}from"react/jsx-runtime";import{addScaleCorrector as n,motion as i,MotionConfigContext as r,useIsPresent as a,animate as l,AnimatePresence as o,LayoutGroup as c,MotionConfig as s,easeOut as p}from"motion/react";import{useRef as u,useEffect as y,forwardRef as d,useContext as f,useImperativeHandle as h,useLayoutEffect as m,useState as g,createContext as v,useMemo as x}from"react";const $="var(--mask-height, 0.15em)",k="var(--mask-width, 0.5em)",b=`calc(${k} / var(--invert-x, 1))`,w="#000 0, transparent 71%",j=`linear-gradient(to right, transparent 0, #000 ${b}, #000 calc(100% - ${b}), transparent),linear-gradient(to bottom, transparent 0, #000 ${$}, #000 calc(100% - ${$}), transparent 100%),radial-gradient(at bottom right, ${w}),radial-gradient(at bottom left, ${w}), radial-gradient(at top left, ${w}), radial-gradient(at top right, ${w})`,S=`100% calc(100% - ${$} * 2),calc(100% - ${b} * 2) 100%,${b} ${$},${b} ${$},${b} ${$},${b} ${$}`;function C({children:e}){return t(i.span,{layout:!0,"aria-hidden":!0,style:{display:"inline-flex","--invert-x":1,margin:`0 calc(-1*${k})`,padding:`calc(${$}/2) ${k}`,position:"relative",zIndex:-1,overflow:"clip",WebkitMaskImage:j,WebkitMaskSize:S,WebkitMaskPosition:"center, center, top left, top right, bottom right, bottom left",WebkitMaskRepeat:"no-repeat"},children:e})}function I(){const t=u(!0);return y((()=>{t.current=!1}),[]),t.current}function M(t){const{width:e,fontSize:n}=getComputedStyle(t);return parseFloat(e)/parseFloat(n)+"em"}n({"--invert-x":{correct:(t,{treeScale:e,projectionDelta:n})=>n.x.scale*e.x}});const W=new WeakMap,z=d((function({value:n,initialValue:o=n,...c},s){const{transition:p}=f(r),d=u(o).current,v=I(),x=u(null),k=u(null);h(s,(()=>k.current),[]);const b=u(new Array(10)),w=a(),j=w?n:0;m((()=>{x.current&&b.current[d]&&(x.current.style.width=M(b.current[d]))}),[]);const S=u(o);m((()=>{if(!x.current||j===S.current)return;const t=x.current.getBoundingClientRect(),e=k.current?.getBoundingClientRect(),n=t.height*(j-S.current)+(t.top-(e?e.top||0:t.top));return l(x.current,{y:[n,0]},p),()=>{S.current=j}}),[j]);const[C,z]=g();y((()=>{if(v&&d===j)return;if(!b.current[j])return;const t=M(b.current[j]);k.current&&W.set(k.current,t),z(t)}),[j]);const L=e=>t("span",{style:{display:"inline-block",padding:`calc(${$}/2) 0`},ref:t=>{b.current[e]=t},children:e},e);return t(i.span,{...c,ref:k,layout:"position","data-state":w?void 0:"exiting",style:{display:"inline-flex",justifyContent:"center",width:C},children:e("span",{ref:x,style:{display:"inline-flex",justifyContent:"center",flexDirection:"column",alignItems:"center",position:"relative"},children:[0!==j&&t("span",{style:{...A,bottom:"100%",left:0},children:new Array(j).fill(null).map(((t,e)=>L(e)))}),L(j),9!==j&&t("span",{style:{...A,top:"100%",left:0},children:new Array(9-j).fill(null).map(((t,e)=>L(j+e+1)))})]})})})),A={display:"flex",flexDirection:"column",alignItems:"center",position:"absolute",width:"100%"},L=v({justify:"left"}),B=d((function({partKey:e,type:n,children:r,...l},c){const s=a(),{justify:p}=f(L);return t(i.span,{...l,"data-state":s?void 0:"exiting",style:{display:"inline-flex",justifyContent:p,padding:`calc(${$}/2) 0`,position:"relative"},layout:"position",ref:c,children:t(o,{mode:"popLayout",anchorX:p,initial:!1,children:t(i.span,{layout:"right"===p&&"position",initial:{opacity:0},animate:{opacity:[null,1]},exit:{opacity:[null,0]},style:{display:"inline-block",whiteSpace:"pre"},children:r},r)})})})),D=d((function({parts:n,justify:r="left",mode:a,style:l,name:c,...s},p){const d=u(null);h(p,(()=>d.current),[]);const f=x((()=>({justify:r})),[r]),m=u(null),v=I(),[$,k]=g();return y((()=>{if(!m.current)return;if(v)return void(d.current&&(d.current.style.width=M(m.current)));const t=Array.from(m.current.children).map((t=>{if(!(t instanceof HTMLElement))return;if("exiting"===t.dataset.state){const e=t.nextSibling;return t.remove(),()=>{m.current&&m.current.insertBefore(t,e)}}const e=W.get(t);if(!e)return;const n=t.style.width;return t.style.width=e,()=>{t.style.width=n}}));k(M(m.current));for(let e=t.length-1;e>=0;e--){const n=t[e];n&&n()}}),[n.map((t=>t.value)).join("")]),t(L.Provider,{value:f,children:t(i.span,{...s,ref:d,className:`number-section-${c}`,style:{...l,display:"inline-flex",justifyContent:r,width:$},children:e("span",{ref:m,style:{display:"inline-flex",justifyContent:"inherit",position:"relative"},children:["â€‹",t(o,{mode:a,anchorX:r,initial:!1,children:n.map((e=>"integer"===e.type||"fraction"===e.type?t(z,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},value:e.value,initialValue:v?void 0:0},e.key):t(B,{type:e.type,partKey:e.key,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.value},"literal"===e.type?`${e.key}:${e.value}`:e.key)))})]})})})})),F={opacity:{duration:1,ease:p},layout:{type:"spring",duration:1,bounce:0},y:{type:"spring",duration:1,bounce:0}},N=d((function({children:n,locales:a,format:l,transition:o,style:p,suffix:u,prefix:y,...d},h){const m=x((()=>((t,{locales:e,format:n},i,r)=>{const a=new Intl.NumberFormat(e,n).formatToParts(Number(t));i&&a.unshift({type:"prefix",value:i}),r&&a.push({type:"suffix",value:r});const l=[],o=[],c=[],s=[],p={},u=t=>`${t}:${p[t]=(p[t]??-1)+1}`;let y="",d=!1,f=!1;for(const t of a){y+=t.value;const e="minusSign"===t.type||"plusSign"===t.type?"sign":t.type;switch(e){case"integer":d=!0,o.push(...t.value.split("").map((t=>({type:e,value:parseInt(t)}))));break;case"group":o.push({type:e,value:t.value});break;case"decimal":f=!0,c.push({type:e,value:t.value,key:u(e)});break;case"fraction":c.push(...t.value.split("").map((t=>({type:e,value:parseInt(t),key:u(e)}))));break;default:(d||f?s:l).push({type:e,value:t.value,key:u(e)})}}const h=[];for(let t=o.length-1;t>=0;t--)h.unshift({...o[t],key:u(o[t].type)});return{pre:l,integer:h,fraction:c,post:s,formatted:y}})(n,{locales:a,format:l},y,u)),[n,a,l]),{pre:g,integer:v,fraction:k,post:b,formatted:w}=m,j=f(r).transition;return t(c,{children:t(s,{transition:o=o??j??F,children:t(i.div,{...d,ref:h,layout:!0,style:{lineHeight:1,...p,display:"inline-flex",isolation:"isolate",whiteSpace:"nowrap"},children:e(i.div,{layout:!0,"aria-label":w,style:{display:"inline-flex",direction:"ltr",isolation:"isolate",position:"relative",zIndex:-1},children:[t(D,{style:{padding:`calc(${$}/2) 0`},"aria-hidden":!0,justify:"right",mode:"popLayout",parts:g,name:"pre"}),e(C,{children:[t(D,{justify:"right",parts:v,name:"integer"}),t(D,{layout:"position",parts:k,name:"fraction"})]}),t(D,{style:{padding:`calc(${$}/2) 0`},"aria-hidden":!0,layout:"position",mode:"popLayout",parts:b,name:"post"})]})})})})}));export{N as AnimateNumber};
